# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении
- карточка товара
```

export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: TCategory;
    price: number | null;
}

```
- оформление заказа
```
export interface IOrder {
    payment: TPaymentMethod;
    email: string;
    address: string;
    phone: string;
    items: string[];
}

```
- список товаров, отображаемый на главной странице приложения
```
export interface IProductsData {
    products: IProduct[];
}

```
- типы оплаты
```
export type TPaymentMethod = 'card' | 'cash';

```
- категории товаров
```
export type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';

```
- данные клиента (в форме оформления заказа)
```
export type TClientOrder = Pick<IOrder, 'payment' | 'address' | 'phone' | 'email'>;

```


 ## Архитерктура приложения
 строится на основании парадигмы **MVP**. Состоит из трех слоев:
1) **Model** (Модель) работает с данными, проводит вычисления и руководит всеми бизнес-процессами.
2) **View** (Вид или представление) показывает пользователю интерфейс и данные из модели.
3) **Presenter** (Представитель) служит прослойкой между моделью и видом.

### Базовый код
#### Класс Api
Содержит базовую логику отправки запросов на сервер. Методы класса:
- `get` — выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` — принимает объект с данными, которые будут переданы в JSON-формате в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - обрабатывает ответ от сервера и возвращает объект. Если ответ успешный, функция возвращает объект JSON, полученный из ответа. Если ответ неуспешный, функция пытается извлечь объект ошибки из ответа JSON. Если объект ошибки не найден, функция возвращает сообщение об ошибке, полученное из ответа.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. \
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:

- `on` — подписка на событие;
- `emit` — инициализация события;
- `trigger` — возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой Model
#### Класс ProductData
Класс отвечает за хранение данных и логику работы с товаром. \
Конструктор класса принимает инстант брокера событий. \
В полях класса хранятся следующие данные:
- _product: IProduct[] - массив объектов (продуктов)
- _preview: string | null - уникальный id продукта, выбранный для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getProducts():IProduct[] - возвращает массив всех товаров
- getProduct(id: string): IProduct - возваращет конкретный товар по уникальному id
- setProduct(product: IProduct[]): void - заполняет массив всех товаров
- savePreview(product:IProduct): void - сохраняет товары в Preview
- saveProduct(product:IProduct):void - сохраняет товар

#### Класс OrderData
Класс отвечает за хранение данных и логику работы с заказом. \
Конструктор класса принимает инстант брокера событий. \
В полях класса хранятся следующие данные:
- payment: TPaymentMethod - выбор способа оплаты
- email: string - почта покупателя
- address: string - адрес покупателя
- phone: string - номер телефона покупателя
- items: string[] - заказанные товары
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- checkValidation(data: Record<keyof TClientOrder, string>): boolean - проверяет заполненные данные на валидность


### Слой View

#### Класс Modal
Реализует модальное окно. Предоставляет методы `open`, `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку крестик для закрытия модального окна. \
- constructor(selector: string, events: EventEmitter, template: templateElement) - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно, темплейт нужного модально окна и экземпляр класса 'EventEmitter' для возможности инициализации событий.

Поля класса:
- modal: HTMLElement — Элемент модального окна, в который подставляется template.
- events: EventEmitter — Брокер событий для управления событиями, связанными с модальным окном.
- divElement: HTMLElement - Блок разметки HTML, который отображается в модальном окне

#### Класс ModalCard
Отвечает за реализацию модального окна, отображающего подробности о конкретном товаре. Позволяет добавлять в корзину. \
Поля класса:
- button: HTMLButtonElement - Кнопка добавления в корзину

Методы:
- setProduct(): void — обновляет информацию, отображаемую в модальном окне (показывает выбранный продукт)


#### Класс ModalBasket
Отвечает за отображение и управление корзиной товаров. Позволяет удалять товар из корзины и переходить к оформлению заказа. \
Поля класса:
- items: TCartProduct[] - массив объектов (продуктов, положенных в корзину)
- summaryPrice: HTMLElement - конечная стоимость покупки

Методы класса:
- setupEventListener(): void — устанавливает слушатели событий для кнопок "Удалить товар" и "Оформить заказ"

#### Класс ModalOrder
Отвечает за отображение и управление формой при оформлении заказа. \
Поля класса:
- button: HTMLButtonElement - кнопка "Далее" для перехода на следующий этап оформления заказа 
- _payment: string — выбранный способ оплаты 
- _address: string — введенный покупателем aдрес доставки
- _email: string — введенный покупателем email 
- _phone: string — введенный покупателем номер телефона 

Методы класса:
- checkValidation(): boolean — проверяет правильность заполнения полей формы
- payOrder(): void — инициирует событие для оплаты
- goNextStep(): void - переход на следующую страниц формы (кнопка "далее")


#### Класс ModalSuccess
Отвечает за отображение сообщения об успешном завершении заказа. \
Поля класса:
- button: HTMLButtonElement - кнопка для перехода на главную страницу

Методы класса:
- goShopping(): void — инициирует событие для перехода на главную страницу

#### Класс Card
Отвечает за отображение карточки товара: название, изображение, цена, описание, категория. Класс используется для отображения товаров на странице сайта и для открытия модального окна с деталями товара при нажатии на карточку. \
В конструктор класса передается DOM элемент темплейта, что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.

Методы класса:
- setData(): void - заполняет атрибуты элементов карточки
- render(): HTMLElement — возвращает заполненную карточку товара.
- deleteCard(): void - удаляет разметку карточки
 

#### Класс CardsContainer
Отвечает за отображение массива товаров на главной странице и отображения счетчика в корзине. Метод сеттер для добавление товаров на страницу пришедших с сервера. В контрукторе принимает элемент контейнер, в который встраиваются товары. Устанавливает слушатель на событие открытия корзины. \
constructor(container: HTMLElement, events: IEvents)

Поля класса:
- _counter: HTMLElement - элемент счетчика
- _cart: HTMLElement - элемент корзины
- _container: HTMLElement - элемент куда встраиваются товары

Методы класса:
- setСounter(value: number) - сеттер для добавления товаров в корзину
- setСontainer(items: HTMLElement[]) - добавление товаров в массив


#### Класс Basket
Отвечает за отображение корзины. В конструкторе принимает контейнер - элемент разметки корзины на главной странице и экземпляр EventEmitter для инициации событий при нажатии пользователем на кнопки. Устанавливает слушатель на все кнопки покупки в карточках, при срабатывании которых генерируется новое отображение количества товаров в корзине

Поля класса:
- _items: HTMLElement - отображение товаров в корзине
- button: HTMLButtonElement - кнопка перехода в корзину с главной страницы
- events: EventEmmiter - брокер событий 

Методы класса:
- setItems(): void - отображает количество товаров в корзине

### Слой Presenter
#### Класс WebApi
Принимает в конструктор экземпляр класс Api и предоставляет методы реализующие взаимодействие с backend приложения.

## Взаимодействие компонентов
Код, описывающий взаимодействие слоя представления и слоя данных между собой и фактически выполняющий роль презентера, находится в файле `index.ts` \
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в `index.ts`
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

Список всех событий, которые могут генерироваться в системе:
- `products:change` - изменение списка тоаров
- `product:select` - инициация открытия модального окна с товаром
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `cart:open` - открытие корзины
- `cart:close` - закрытие корзины
- `cart:change` - изменение количества товаров в корзине
- `order:open` - открытие модального окна заказа
- `order:change` - изменения в модальном окне при оформлении заказа 
- `order:success` — подтверждение успешного завершения заказа
- `form: change` - валидация формы при оформлении заказа




