# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении
- карточка товара
```

export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}

```
- оформление заказа (формы)
```
export interface IOrderForm {
    payment: string;
    email: string;
    phone: string;
    address: string;  
}

export interface IOrder extends IOrderForm{
    total: number;
    items: string[];
}


export interface IOrderResult {
    id: string;
    total: number;
}

```
- API клиента
```
export interface IAppState {
    catalog: IProduct[];
    preview: string | null;
    order: IOrder | null;
}

```
- ошибки валидации
```
export type FormErrors = Partial<Record<keyof IOrder, string>>


```
- типы оплаты
```
export type PaymentMethod = 'cash' | 'card' | '';
export type CategoryPayment = {
  [Key in PaymentMethod]: string;
};

```


 ## Архитерктура приложения
 строится на основании парадигмы **MVP**. Состоит из трех слоев:
1) **Model** (Модель) работает с данными, проводит вычисления и руководит всеми бизнес-процессами.
2) **View** (Вид или представление) показывает пользователю интерфейс и данные из модели.
3) **Presenter** (Представитель) служит прослойкой между моделью и видом.

### Базовый код
#### Класс Api
Содержит базовую логику отправки запросов на сервер. Методы класса:
- `get` — выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` — принимает объект с данными, которые будут переданы в JSON-формате в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - обрабатывает ответ от сервера и возвращает объект. Если ответ успешный, функция возвращает объект JSON, полученный из ответа. Если ответ неуспешный, функция пытается извлечь объект ошибки из ответа JSON. Если объект ошибки не найден, функция возвращает сообщение об ошибке, полученное из ответа.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. \
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:

- `on` — подписка на событие;
- `emit` — инициализация события;
- `trigger` — возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Абстрактный класс Component
Класс, принимает HTML элемент, который будет использоваться как контейнер для компонента. 
Методы класса:
 - `toggleClass` - метод для переключения класса у элемента;
 - `setText` - метод для установки текстового содержимого у элемента;
- `setDisable` - метод для установки состояния disable у элемента;
- `setHidden` - метод для скрытия элемента; 
- `setVisible` - метод для отображения элемента;
- `setImage` - метод для установки узображения;
- `render` - метод для возращения корневого DOM элемента для отображения на странице;



### Слой Model

#### Абстрактный класс Model
Класс представляет собой базовую модель данных, которая может быть расширена другими классами. Позволяет инициализировать свои свойства с помощью частичных данных и уведомлять о любых изменениях через систему событий.
Метод класса:
 - `emitChanges` - метод класса, который уведомляет о том, что модель изменилась;

#### Класс AppState
Класс отвечает за хранение данных и логику работы с товаром. \
В полях класса хранятся следующие данные:
- catalog: IProduct[] - массив объектов (каталог продуктов)
- order: IOrder = Object.assign({}, orderStart) - объект заказа, который инициилизуруется значениями из объекта orderStart
- preview: string | null - строка или null, представляющая ID предварительно выбранного товара
- formErrors: FormErrors = {} - объект для хранения ошибок в форме 

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `setCatalog` - Метод для установки каталога товаров. 
- `setPreview` - Метод для установки предварительного просмотра товара
- `setOrderField` - Метод для обновления поля заказа. После изменения вызывается валидация заказа, и если она успешна, отправляется событие о готовности заказа
- `getOrderProducts` - Метод для получения списка товаров, добавленных в корзину, путем фильтрации каталога
- `getTotal` - Метод для вычисления общей стоимости заказа. Он суммирует цены всех товаров в корзине
- `validateOrder` - Метод для валидации формы заказа. Проверяет, заполнены ли все обязательные поля, и если есть ошибки, они сохраняются в объекте formErrors. 
- `addItemsToBasket` - Метод для добавления товара в корзину. Если товар не продается (цена равна null), выводится предупреждение
- `deleteItemsFromBasket` - Метод для удаления товара из корзины
- `clearBasket` - Метод для очистки корзины
- `isItemAdded` - Метод для проверки, добавлен ли товар в корзину
- `isItemHasPrice` - Метод для проверки, установлена ли цена у товара

### Слой View

#### Класс Modal
Реализует модальное окно. Предоставляет методы `open`, `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна на клик в оверлей и кнопку крестик для закрытия модального окна. \
В конструкторе принимает два параметра: container - элемент HTML, в котором будет находиться модальное окно и экземпляр EventEmitter для инициации событий при нажатии пользователем на кнопки. \
Наследуется от абстрактного класса Component.

Поля класса:
- _closeButton: HTMLButtonElement - кнопка для закрытия модального окна
- _content: HTMLElement - элемент, в который будет помещено содержимое модального окна

Методы класса:
- `set content` - сеттер. Устанавливает содержимое модального окна
- `render` - метод, для отображения модального окна на странице

#### Класс Success
Отвечает за отображение сообщения об успешном завершении заказа. \
В конструкторе принимает два параметра: container - элемент HTML, в котором будет находиться модальное окно и экземпляр EventEmitter для инициации событий при нажатии пользователем на кнопки. \
Наследуется от абстрактного класса Component.
Поля класса:
- _close: HTMLButtonElement - кнопка закрытия
- _total: HTMLElement - элемент, в котором будет отображаться общее количество списанных средств

Методы класса:
- `set total` - сеттер. устанавливает значение общего количества списанных средств

#### Класс Card
Отвечает за отображение карточки товара: название, изображение, цена, описание, категория (на главной странице). \
В конструкторе принимает три параметра: Имя блока, которое используется для поиска элементов. container - элемент, в котором будет располагаться карточка. Объект с действиями, например, обработчик события клика. \
Наследуется от абстрактного класса Component.
Поля класса содержат элементы разметки элементов карточки:
- _title: HTMLElement - заголовок (наименование продукта)
- _image: HTMLImageElement - изображение продукта
- _category: HTMLElement - категория продукта
- _price: HTMLElement - цена продукта

Методы класса:
- `set id` - сеттер. для установки идентификатора товара
- `get id` - геттер. для получения идентификатора товара
- `set title` - сеттер. для установки наименования (заголовка)
- `get title` - геттер. для получения наименования (заголовка)
- `set image` - сеттер. для установки изображения
- `set category` - сеттер. для установки значения категории
- `set price` - сеттер. для установки цены товара

#### Класс CardPreview
Отвечает за отображение (выбранной) карточки товара. \
В конструкторе принимает два параметра: container - элемент, в котором будет располагаться карточка. Объект с действиями, например, обработчик события клика. \
Наследуется от класса Card.
Поля класса содержат элементы разметки элементов карточки:
- _description: HTMLElement - описание выбранного товара
- _button: HTMLButtonElement - кнопка добавления товара в корзину

Методы класса:
- `set description` - сеттер. Метод для установки текста описания карточки
- `addBlockButton` - Метод для управления состоянием кнопки
- `setButtonText` - Метод для установки текста кнопки

#### Класс CardInBasket
Отвечает за отображение (выбранной) карточки товара в корзине. \
В конструкторе принимает два параметра: Имя блока, которое используется для поиска элементов. container - элемент, в котором будет располагаться карточка. Объект с действиями, например, обработчик события клика. \
Наследуется от класса абстрактного класса Component.
Поля класса содержат элементы разметки элементов карточки:
- _title: HTMLElement - заголовок карточки
- _price: HTMLElement - цена товара
- _button: HTMLButtonElement - кнопка удаления товара из корзины
- _index: HTMLElement - номер товара в корзине

Методы класса:
- `set index` - сеттер. Для утсановки значения номера товара в корзине
- `set title` - сеттер. Для устанвоки названия товара
- `set price` - сеттер. Для установки цены товара
- `get title` - геттер. Для получения названия товара
- `get price` - геттер. Для получения цены товара

#### Класс View
Отвечает за управление элементами страницы интернет-магазина . \
В конструкторе принимает два параметра:  container (родительский элемент для страницы) и events (объект для управления событиями). \
Наследуется от класса абстрактного класса Component.
Поля класса содержат элементы разметки элементов карточки:
- _counter: HTMLElement - элемент, который показывает количество товаров в корзине
- _catalog: HTMLElement - элемент, который будет содержать все карточки товаров на главной странице
- _wrapper: HTMLElement - обертка для всей страницы
- _basket: HTMLElement - элемент, который представляет корзину

Методы класса:
- `set counter` - сеттер. Устанавливает количество товаров в корзине
- `set catalog` - сеттер. Принимает массив HTML-элементов и заменяет содержимое элемента _catalog на новые карточки товаров
- `set locked` - сеттер. Управляет блокировкой прокрутки страницы

### Слой Presenter
#### Класс WebLarekApi
Отвечает за взаимодействие с сервером. \
В конструкторе принимает три параметра: строку, представляющую адрес CDN. Этот параметр передается при создании объекта LarekApi. базовый URL для API, который также передается в конструктор. Дополнительные (опциональные) параметры для настройки запросов. . \
Наследуется от класса Api.

Методы класса:
- `getProducts` - метод возвращает список продуктов из API
- `orderProducts` - метод позволяет сделать заказ продукта

Взаимодействие компонентов
Код, описывающий взаимодействие слоя представления и слоя данных между собой и фактически выполняющий роль презентера, находится в файле index.ts
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в index.ts В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

Список всех событий, которые могут генерироваться в системе:
`items: changed` - изменение списка товаров
`card: selected` - инициация открытия модального окна с товаром
`preview: changed` - изменение выбранной карточки товара
`basket: open` - открытие корзины
`basket:change` - изменение количества товаров в корзине
`order:open` - открытие модального окна заказа
`formError: change` - валидация формы при оформлении заказа
`order: submit` - отправка формы заказа
`contacts: submit` - отправка контактной информации
`modal: open` - открытие модального окна
`modal: close` - закрытие модального окна

