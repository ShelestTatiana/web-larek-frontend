# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении
- карточка товара
```

export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: TCategory;
    price: number | null;
}

```
- оформление заказа
```
export interface IOrder {
    payment: TPaymentMethod;
    email: string;
    address: string;
    phone: string;
    items: string[];
}

```
- список товаров, отображаемый на главной странице приложения
```
export interface IProductsData {
    products: IProduct[];
}

```
- типы оплаты
```
export type TPaymentMethod = 'card' | 'cash';

```
- категории товаров
```
export type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';

```
- данные клиента (в форме оформления заказа)
```
export type TClientOrder = Pick<IOrder, 'payment' | 'address' | 'phone' | 'email'>;

```


 ## Архитерктура приложения
 строится на основании парадигмы **MVP**. Состоит из трех слоев:
1) **Model** (Модель) работает с данными, проводит вычисления и руководит всеми бизнес-процессами.
2) **View** (Вид или представление) показывает пользователю интерфейс и данные из модели.
3) **Presenter** (Представитель) служит прослойкой между моделью и видом.

### Базовый код
#### Класс Api
Содержит базовую логику отправки запросов на сервер. Методы класса:
- `get` — выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` — принимает объект с данными, которые будут переданы в JSON-формате в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - обрабатывает ответ от сервера и возвращает объект. Если ответ успешный, функция возвращает объект JSON, полученный из ответа. Если ответ неуспешный, функция пытается извлечь объект ошибки из ответа JSON. Если объект ошибки не найден, функция возвращает сообщение об ошибке, полученное из ответа.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. \
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:

- `on` — подписка на событие;
- `emit` — инициализация события;
- `trigger` — возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой Model
#### Класс ProductData
Класс отвечает за хранение данных и логику работы с товаром. \
Конструктор класса принимает инстант брокера событий. \
В полях класса хранятся следующие данные:
- _product: IProduct[] - массив объектов (продуктов)
- _preview: string | null - уникальный id продукта, выбранный для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- getProducts():IProduct[] - возвращает массив всех товаров
- getProduct(id: string): IProduct - возваращет конкретный товар по уникальному id
- setProduct(product: IProduct[]): void - заполняет массив всех товаров
- savePreview(product:IProduct): void - сохраняет товары в Preview
- saveProduct(product:IProduct):void - сохраняет товар

#### Класс OrderData
Класс отвечает за хранение данных и логику работы с заказом. \
Конструктор класса принимает инстант брокера событий. \
В полях класса хранятся следующие данные:
- payment: TPaymentMethod - выбор способа оплаты
- email: string - почта покупателя
- address: string - адрес покупателя
- phone: string - номер телефона покупателя
- items: string[] - заказанные товары
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- checkValidation(data: Record<keyof TClientOrder, string>): boolean - проверяет заполненные данные на валидность


### Слой View

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления.
Конструктор класса:
- element: HTMLElement — Основной родительский контейнер компонента, в который будет отрисовывать содержимое.

Методы класса:
- render(): HTMLElement — Метод для отображения данных в компоненте. Принимает объект и сохраняет его в соответствующих полях компонентов через сеттеры и возвращает обновленный DOM-элемент компонента.

#### Класс Modal
Реализует модальное окно. Предоставляет методы `open`, `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку крестик для закрытия модального окна. \
Конструктор класса:
- selector: string — Селектор, по которому в DOM идентифицируется модальное окно.
- events: EventEmitter — Экземпляр класса EventEmitter для взаимодействия с другими компонентами через события.

Поля класса:
- modal: HTMLElement — Элемент модального окна, найденный по переданному селектору.
- events: EventEmitter — Экземпляр брокера событий для управления событиями, связанными с модальным окном.

#### Класс ModalAboutProduct
Отвечает за реализацию модального окна, отображающего подробности о конкретном товаре. Позволяет добавлять в корзину. \
Поля класса:
- modal: HTMLElement — Элемент модального окна
- button: HTMLButtonElement - Кнопка добавления в корзину

Методы:
- open(): void - открывает модальное окно
- close(): void — закрывает модальное окно
- setProduct(): void — обновляет информацию, отображаемую в модальном окне (показывает выбранный продукт)


#### Класс ModalCart
Расширяет класс Modal. Отвечает за отображение и управление корзиной товаров. Позволяет удалять товар из корзины и переходить к оформлению заказа. \
Поля класса:
- modal: HTMLElement — Элемент модального окна
- items: TCartProduct[] - массив объектов (продуктов, положенных в корзину)
- summaryPrice: number | null - конечная стоимость покупки
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 


Методы класса:
- deleteProduct(productId: string): void - удаляет конкретный товар из корзины
- open(): void - открывает модальное окно
- close(): void — закрывает модальное окно
- submitOrder(): void — инициирует процесс оформления заказа


#### Класс ModalOrder
Расширяет класс Modal. Отвечает за отображение и управление формой при оформлении заказа. \
Поля класса:
- modal: HTMLElement — Элемент модального окна
- button: HTMLButtonElement - кнопка "Далее" для перехода на следующий этап оформления заказа 
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 
- _payment: string — выбранный способ оплаты 
- _address: string — введенный покупателем aдрес доставки
- _email: string — введенный покупателем email 
- _phone: string — введенный покупателем номер телефона 

Методы класса:
- checkValidation(): boolean — проверяет правильность заполнения полей формы
- payOrder(): void — инициирует событие для оплаты


#### Класс ModalSuccess
Расширяет класс Modal. Отвечает за отображение сообщения об успешном завершении заказа. \
Поля класса:
- modal: HTMLElement — Элемент модального окна
- button: HTMLButtonElement - кнопка для перехода на главную страницу
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 

Методы класса:
- goShopping(): void — инициирует событие для перехода на главную страницу

#### Класс Product
Отвечает за отображение карточки товара: название, изображение, цена, описание, категория. Класс используется для отображения товаров на странице сайта и для открытия модального окна с деталями товара при нажатии на карточку. \
Поля класса:
- element: HTMLElement — Основной DOM элемент карточки.
- events: IEvents — Экземпляр класса `EventEmitter` для инициации событий.

Методы класса:
- render(): HTMLElement — возвращает заполненную карточку товара.
- openModalAboutProduct(): void — открывает модальное окно с подробной информацией о товаре. 

#### Класс ProductContainer
Отвечает за отображение массива товаров на главной странице и отображения счетчика в корзине. Метод сеттер для добавление товаров на страницу пришедших с сервера. В контрукторе принимает элемент контейнер, в который встраиваются товары. Устанавливает слушатель на событие открытия корзины. \
constructor(container: HTMLElement, events: IEvents)

Поля:
- _counter: HTMLElement - элемент счетчика
- _cart: HTMLElement - элемент корзины
- _container: HTMLElement - элемент куда встраиваются товары

Методы:
- set counter(value: number) - сеттер для добавления товаров в корзину
- set container(items: HTMLElement[]) - добавление товаров в массив

### Слой Presenter
#### Класс WebApi
Принимает в конструктор экземпляр класс Api и предоставляет методы реализующие взаимодействие с backend приложения.

## Взаимодействие компонентов
Код, описывающий взаимодействие слоя представления и слоя данных между собой и фактически выполняющий роль презентера, находится в файле `index.ts` \
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в `index.ts`
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий

Список всех событий, которые могут генерироваться в системе:
- `products:change` - изменение списка тоаров
- `product:select` - инициация открытия модального окна с товаром
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `cart:open` - открытие корзины
- `cart:close` - закрытие корзины
- `cart:change` - изменение количества товаров в корзине
- `order:open` - открытие модального окна заказа
- `order:change` - изменения в модальном окне при оформлении заказа 
- `order:success` — подтверждение успешного завершения заказа
- `form: change` - валидация формы при оформлении заказа




